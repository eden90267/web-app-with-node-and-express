# chap20. 除錯

在本章中，我們要討論一些對Node與Express應用程式有效率地除錯的工具及技術。

## 除錯的第一原則

>我說了那麼多次，當你將所有不可能發生的事情排除在外，剩下的就算多麽讓人難以置信，也必定是真相？

—— Sir Authur Conan Doyle

第一及最重要的除錯原則是**排除**的程序。

排除有許多形式，以下是一些常見的做法：

- 有系統地將一個程式段落改成註解，或停用。
- 編寫可讓單元測試發現的程式碼，單元測試本身提供一種進行排除的框架。
- 分析網路流量來判斷問題出在用戶端還是伺服器端。
- 測試系統內一開始很類似的各個部分。
- 輸入之前可以正常動作的資料，並慢慢改變該項輸入的各個部分，直到問題出現為止。
- 使用版本控制回到正常時間，把一個時間當成一步，直到問題消失為止。
- “模仿”功能來排除複雜的子系統

之所以發生問題，往往是因為兩個元件以上的元件之間複雜地互動，排除或模仿任何元件，問題可能消失，但問題無法從任何單一元件身上排除。“排除”無法在正確的位置上亮起霓虹燈，但可協助縮小問題。

細心、有條理地使用，排除是最有效的方法。但排除元件，要思考元件如何影響整個系統。

## 利用REPL與主控台

## 使用Node的內建除錯程式

```
node debug meadowlark.js
```

Node除錯程式會建立它自己的Web伺服器來工作，可讓你控制被除錯的應用程式的執行。討論到Node Inspector，就會看到這種方法的實用。

在主控台除錯程式裡面，可輸入help看指令的清單。

- n(下一個)
- s(步進進入)
- o(步進離開)

指令列除錯程式，你應該不會經常使用它們。你一定比較喜歡使用圖形除錯器，如Node Inspector。

## Node Inspector

Node透過Web服務來公開它的除錯控制項，讓你有其他的選擇。特別是Danny Coates傑出的Node Inspector(現由StrongLoop管理)可讓你使用在用戶端除錯JavaScript程式的介面來除錯Node應用程式。

Node Inspector使用Chromium專案的Blink引擎，它也是Chrome的引擎。

```
sudo npm install -g node-inspector
```

接著背景執行它：

```
node-inspector&
```

接著你可以在除錯模式下啟動：

```
node --debug meadowlark
```

你有三個不同的應用程式在三個不同埠上執行

- 5858：你的app在5858埠公開它的除錯介面
- 8080：Node Inspector在8080埠執行，監聽5858

連結[http://127.0.0.1:8080/debug?port=5858](http://127.0.0.1:8080/debug?port=5858)，一探究竟。

最簡單使用方式：Sources選單設定**中斷點**。