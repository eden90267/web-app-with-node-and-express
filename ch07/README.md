# chap07. 使用Handlebars來製作樣板

在Web上使用的語言，幾乎都已內建某種形式的樣板資源。

但現在不同的地方在於，"模板引擎"已經與語言分開。典型的例子是Mustache。

傳統用JavaScript發出HTML會有很多問題：

- 你必須經常考慮有哪些字元需要轉譯。
- 如果你要使用JavaScript來產生本身含有JavaScript的HTML，很快會抓狂
- 你通常不能使用編輯器的"語意亮顯"及其他好用的語言專屬功能
- 更難找出不正確的HTML
- 很難直觀地解析
- 其他人很難了解你的程式碼

樣板可以解決這些問題，因為它可讓你用目標語言編寫，同時提供插入動態資料的能力。

以下為使用Mustache模板：

```
<h1>Much Better</h1>
<p>No <span class="code">document.write</span> here!</p>
<p>Today's data is {{today}}.</p>
```

現在我們要做的，只是提供{{today}}的值，這也就是樣板語言的核心了。

## 除了這一條規則之外，就沒有絕對的規則了

並不是建議永遠都不要用JavaScript來編寫HTML，而是要盡可能地避免這件事。特別是因為前端程式碼比較貼心。非常簡單的情況下就比較沒關係。

```
$('#error').html('Something <b>very bad</b> happened!');
```

## 選擇模板引擎

以下是一些考量的準則：

- 效能
- 用戶端? 伺服器? 或兩者?

    如果要在兩端同時使用樣板，建議選擇兩端都可使用的。

- 抽象

    想要某些似曾相識的東西，或其實不喜歡HTML，而喜歡那些讓你不必使用括號的東西。樣板(特別是伺服器端樣板)提供一些選項。

## Jade：一種不同的做法

Jade會為你將HTML的細節抽象化。另一點值得注意是，Jade是為我們帶來Express的TJ Holowaychuk的心血結晶。

Jade肯定會減少許多文字輸入：不需角括號或封閉標籤。相反地，它依賴縮排及一些符合常識的規則。Jade還有項額外優點：理論上，當HTML改變時，你可以讓Jade重新指定HTML的最新版本，讓你可以"確保未來"的內容。

佩服Jade的哲學及它執行上的優雅的同時，我不希望HTML的細節被抽象掉。身為一位Web開發者，HTML是我工作的核心，就算鍵盤上的角括號會被手指磨耗，我也只有認命。

這裡是我們與Jade分道揚鑣的地方。

## Handlebars基礎

Handlebars是Mustache的擴充，是另一種受歡迎的樣板引擎。推薦Handlebars的原因，是它可以輕鬆地整合JavaScript(包括前端與後端)及類似的語法。對我而言，它打破所有的權力平衡。

要了解樣板引擎，關鍵在了解**內容**(*context*)的概念。當你轉譯一個模板時，你會傳送一個物件，名為**內容物件**(context object)給模板引擎，這就是替換進行的地方。

內容物件：`{name: 'Buttercup'}`，且模板引擎是`<p>Hello, {{name}}!</p>`，{{name}}會被取代為Buttercup。

如果要將HTML傳送到模板，只要三個大括號即可：`{{{name}}}`(使用三個大括號來關閉HTML轉譯功能。在沒有HTML轉譯的情況下呈現內容的特性，對**版面**及**區段**而言都很重要)。

### 註解

Handlebars的註解長得像這樣：`{{! comment goes here}}`。與HTML註解不同的是，假設它是伺服器端的模板，裡面的極機密註解永遠不會被送到瀏覽器。

### 區塊

當你開始考慮**區塊**，事情會變得比較複雜。區塊提供流程控制、條件執行及擴充功能。考慮下列的內容物件：

```

```